<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</title><link rel="stylesheet" href="style.css"></head>
<body>
  <div class="header">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</div>
  <div class="container">
    <div id="adArea">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    <div class="footer"></div>
  </div>

<script src="script.js"></script>
<script>
const id = app.getQuery('id');
const ad = app.getAdById(id);

if(!ad){
  document.getElementById('adArea').innerHTML = '<div class="center">Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</div>';
} else {
  // Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
  const html = `
  <div class="ad-main">
    <div>
      <div class="ad-images">
        <img id="mainImg" src="${ad.images[0] ? ad.images[0] : 'https://via.placeholder.com/900x600?text=ØµÙˆØ±Ø©'}" alt="">
        <div class="thumb-row" id="thumbs">
          ${ (ad.images || []).map((im,idx)=>`<img src="${im}" data-idx="${idx}" class="${idx===0? 'selected':''}">`).join('') }
        </div>
      </div>

      <div style="margin-top:12px;background:white;padding:12px;border-radius:10px">
        <div style="font-size:20px;font-weight:800">${ad.title}</div>
        <div style="margin-top:8px;color:var(--gold-1);font-weight:800">${app.fmt(ad.price)}</div>
        <div style="margin-top:8px;color:var(--muted)">${ad.city} â€¢ ${ad.category}</div>
        <div style="margin-top:12px">${ad.desc}</div>
      </div>
    </div>

    <aside class="sidebar">
      <div class="info-row"><div><label class="smallmuted">Ø§Ù„Ø§Ø³Ù…</label><div>${ad.email || 'â€”'}</div></div></div>
      <div class="info-row"><div><label class="smallmuted">Ø§Ù„Ù‡Ø§ØªÙ</label><div>${ad.phone || 'â€”'}</div></div></div>
      <div class="info-row"><div><label class="smallmuted">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><div>${ad.city}</div></div></div>

      <div style="margin-top:12px">
        <button class="btn" onclick="openWhatsApp()">ğŸ“² ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨</button>
        <button class="btn secondary" onclick="openMail()">âœ‰ï¸ Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø±ÙŠØ¯</button>
      </div>

      <div style="margin-top:12px">
        <button class="btn small" style="background:#d32f2f" onclick="onDelete()">Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†</button>
      </div>
    </aside>
  </div>
  `;
  document.getElementById('adArea').innerHTML = html;

  // thumbs click
  document.querySelectorAll('#thumbs img').forEach(img=>{
    img.addEventListener('click', function(){
      document.querySelectorAll('#thumbs img').forEach(x=>x.classList.remove('selected'));
      this.classList.add('selected');
      document.getElementById('mainImg').src = this.src;
    });
  });

  // actions
  window.openWhatsApp = function(){
    const wa = app.phoneToWa(ad.phone);
    const text = encodeURIComponent(`Ù…Ø±Ø­Ø¨Ø§ØŒ Ø¨Ø®ØµÙˆØµ Ø¥Ø¹Ù„Ø§Ù†: ${ad.title}`);
    window.open(`https://wa.me/${wa}?text=${text}`,'_blank');
  };
  window.openMail = function(){
    const mail = ad.email || '';
    window.location.href = `mailto:${mail}?subject=Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø¥Ø¹Ù„Ø§Ù†: ${encodeURIComponent(ad.title)}&body=Ù…Ø±Ø­Ø¨Ø§Ù‹`;
  };
  window.onDelete = function(){
    if(confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ØŸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù†Ù‡.')){
      app.deleteAd(ad.id);
      alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†');
      location.href = 'ads.html';
    }
  };
}
</script>
</body>
</html>